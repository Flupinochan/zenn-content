---
title: "Dify導入 個人メモ"
emoji: "🗂"
type: "tech"
topics: ["aws", "dify"]
published: false
---

急に RAG チャットボットを導入することになったので…
定期的に更新します

## Install Docker Compose

https://zenn.dev/rock_penguin/articles/28875c7b0a5e30<br>
https://github.com/docker/compose/releases/<br>

※以下の v2.29.7 をインストール
https://github.com/docker/compose/releases/download/v2.29.7/docker-compose-linux-x86_64

```bash
sudo -s
cd
dnf update
dnf install -y docker
systemctl start docker
gpasswd -a $(whoami) docker
chgrp docker /var/run/docker.sock
systemctl restart docker
systemctl enable docker
curl -L "https://github.com/docker/compose/releases/download/v2.29.7/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
```

「uname -s」は OS 名、例えば「Linux」
「uname -m」は CPU アーキテクチャ、例えば「x86_64」<br>

```bash
docker -v
docker-compose -v
```

## Install Git

```bash
dnf install -y git
```

## Install Dify

https://docs.dify.ai/ja-jp/getting-started/install-self-hosted/docker-compose#difyno<br>
https://github.com/langgenius/dify/blob/main/docker/docker-compose.yaml<br>
https://docs.docker.jp/compose/profiles.html<br>

※以下のように記載があり、profiles で、qdrant をベクトルデータベースとして起動可能
　現在は、Qdrant が推奨されている

```yaml
# Qdrant vector store.
# (if used, you need to set VECTOR_STORE to qdrant in the api & worker service.)
qdrant:
image: langgenius/qdrant:v1.7.3
profiles:
  - qdrant
restart: always
volumes:
  - ./volumes/qdrant:/qdrant/storage
environment:
  QDRANT_API_KEY: ${QDRANT_API_KEY:-difyai123456}
```

https://docs.dify.ai/ja-jp/getting-started/readme/features-and-specifications

```bash
git clone https://github.com/langgenius/dify.git
cd dify/docker
cp .env.example .env
docker-compose --profile qdrant up -d # qdrantをベクトルデータベースとして起動
docker-compose ps
```

以下でアクセスする

```bash
http://localhost/
http://グローバル IP アドレス/
```

## スペックについて

EC2 の IAMRole は、最低限 Bedrock へのアクセス権限を付与しておくように
t3.medium で起動可能
EBS は、最小で 7.3GB 使用した
Knowledge Base を使用してデータを蓄積する場合は、50 ～ 100GB くらいあっても良いと思う

## ログ・トレーシング

https://zenn.dev/aidemy/articles/13ceca39b0ea6c<br>
https://langfuse.com/pricing<br>

Langfuse が無料で使用可能
