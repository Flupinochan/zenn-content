---
title: "AWS SCPã‚’CodeCommitã§ç®¡ç†ã™ã‚‹"
emoji: "ğŸ£"
type: "tech"
topics:
  - "aws"
  - "codepipeline"
  - "scp"
  - "codebuild"
  - "organizations"
published: true
published_at: "2024-08-16 04:53"
---

ä»¥ä¸‹ã‚’å‚è€ƒã«CodeBuildã§AWS CLIã‚’å®Ÿè¡Œã—ã¦CodeCommitã«æ ¼ç´ã—ã¦ã„ã‚‹SCPã«æ›´æ–°ã™ã‚‹ã ã‘ã§ã™
https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps_create.html#update_policy

## SCPã®IDã‚’ç¢ºèª
SCPã®ARNã®æœ«å°¾ãŒã€SCPã®IDã«ãªã‚Šã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/ebe75e187bc5-20240816.png)

## CodeCommitã«SCPç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨buildspec.ymlã‚’ä½œæˆ
![](https://storage.googleapis.com/zenn-user-upload/fab5ff3f2a18-20240816.png)
ãƒ»SCPã®ä¾‹ (s3:*ã‚’è¿½åŠ )
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "Statement1",
      "Effect": "Allow",
      "Action": [
        "ec2:*",
        "s3:*"
      ],
      "Resource": [
        "*"
      ]
    }
  ]
}
```

ãƒ»buildspec.ymlã®ä¾‹
```json
version: 0.2

# PolicyIDã¨Fileåã¯SCPã«åˆã‚ã›ã‚‹ã“ã¨
phases:
  build:
    commands:
      - "ls -l"
      - "aws organizations update-policy --policy-id p-uroor9m1 --content file://Allow-SCP"
```


## ã»ã¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã§CodeBuildã¨CodePipelineã‚’ä½œæˆã—ã¾ã™
ä½œæˆæ‰‹é †ã¯å‰²æ„›ã—ã¾ã™â€¦
â€»CodeBuildã®IAM Roleã«ã¯ã€ä»¥ä¸‹ã®SCPã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®IAM Policyã‚’ä»˜ä¸ã—ã¦ãã ã•ã„
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "organizations:UpdatePolicy",
                "organizations:DescribePolicy"
            ],
            "Resource": "*"
        }
    ]
}
```
![](https://storage.googleapis.com/zenn-user-upload/f5dcbb73af6a-20240816.png)
ä»¥ä¸‹ã®ã‚ˆã†ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚Œã°OK!
![](https://storage.googleapis.com/zenn-user-upload/bcfa26cc739d-20240816.png)
çµ‚ã‚ã‚Š(o _ _)o