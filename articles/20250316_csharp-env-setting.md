---
title: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šç®¡ç†æ–¹æ³•"
emoji: "ğŸˆ"
type: "tech"
topics: ["csharp", "windows"]
published: true
---

## ã¯ã˜ã‚ã«

C# Visual Studio WPFã§ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸéš›ã«å­¦ã‚“ã ã“ã¨ã§ã™
ä»–ã®è¨€èªã«ã‚‚å…±é€šã™ã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™

## æ¦‚è¦

ä»¥ä¸‹ã®ã‚ˆã†ãªè¦ä»¶ãŒã‚ã‚Šã¾ã—ãŸ

- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¦ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§å‹•ä½œã•ã›ãŸã„
- ãƒ“ãƒ«ãƒ‰å¾Œã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã€å‹•ä½œã‚’å¤‰ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã„

## å¤±æ•—

æœ€åˆã¯ã€C#ã‚³ãƒ¼ãƒ‰å†…ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ç›´æ¥è¨˜è¼‰ã—ã¦ã„ã¾ã—ãŸ
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å¤‰ãˆã‚‹å ´åˆã¯ã€C#ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸ

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š: C#ã‚³ãƒ¼ãƒ‰
- ä¸Šæ›¸ãè¨­å®š: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«(.jsonç­‰)

## æˆåŠŸ

æ­£ã—ãã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã¨ä¸Šæ›¸ãè¨­å®šãŒåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šå¯èƒ½ã«ã™ã‚‹ã“ã¨ã§ã™ãŒã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’é©ç”¨ã•ã›ã‚‹æ–¹æ³•ãŒåˆ†ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«(.jsonç­‰)
- ä¸Šæ›¸ãè¨­å®š: å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«(.jsonç­‰)

C# Visual Studioã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ `ãƒ“ãƒ«ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ = åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹` ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ“ãƒ«ãƒ‰æ™‚ã«exeãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒåŸ‹ã‚è¾¼ã¾ã‚Œã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¦ã‚‚ã€ãƒ“ãƒ«ãƒ‰æ™‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒå‚ç…§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™!

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚Œã°ã€ãã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å€¤ã‚’èª­ã¿è¾¼ã‚€ã ã‘ã§ã™

env.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹

![](/images/20250316_csharp-env-setting/1.png)

â€»`å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ = å¸¸ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹` ã‚’è¨­å®šã™ã‚‹ã¨ã€exeãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒéšå±¤ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºåŠ›ã•ã‚Œã¾ã™
ã“ã‚Œã‚’ä¸Šæ›¸ãç”¨ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¾ã—ãŸ

## å®Ÿè¡Œä¾‹

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªã®ä¾‹ã§ã™

1. ãƒ“ãƒ«ãƒ‰ç›´å¾Œã«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã® env.json ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹çŠ¶æ…‹ã§exeãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ

![](/images/20250316_csharp-env-setting/2.png)
![](/images/20250316_csharp-env-setting/3.png)

2. env.json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã¦å®Ÿè¡Œ

![](/images/20250316_csharp-env-setting/4.png)
![](/images/20250316_csharp-env-setting/5.png)

3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦å®Ÿè¡Œ

![](/images/20250316_csharp-env-setting/6.png)
![](/images/20250316_csharp-env-setting/7.png)


## ã‚³ãƒ¼ãƒ‰ä¾‹

1. åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹åã¯ã€`åå‰ç©ºé–“.ãƒ•ã‚©ãƒ«ãƒ€å.ãƒ•ã‚¡ã‚¤ãƒ«å` ã®ã‚ˆã†ãªå½¢å¼

â€»åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹åãŒåˆ†ã‹ã‚‰ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹åã‚’ä¸€è¦§å–å¾—å¯èƒ½

```csharp
String[] embeddingResourceNames = Assembly.GetExecutingAssembly().GetManifestResourceNames();
Console.WriteLine($"åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹åä¸€è¦§: {String.Join(Environment.NewLine, embeddingResourceNames)}");
```

2. åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿å–å¾—æ–¹æ³•

```csharp
String envResourceName = "EnvConfigTest.env.json";
Stream resourceStream = Assembly.GetExecutingAssembly().GetManifestResourceStream(envResourceName)
```

3. å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼ã—ãŸå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹å–å¾—æ–¹æ³•

```csharp
String exeFolderPath = AppDomain.CurrentDomain.BaseDirectory;
Console.WriteLine($"exeãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹: {exeFolderPath}");

String envPath = Path.Combine(exeFolderPath, "env.json");
Console.WriteLine($"env.jsonã®ãƒ‘ã‚¹: {envPath}");
```

å…¨ã‚³ãƒ¼ãƒ‰

```csharp
using System.Reflection;
using System.Text.Json;

namespace EnvConfigTest;

public static class JsonOptionsProvider
{
    public static readonly JsonSerializerOptions Options = new JsonSerializerOptions { WriteIndented = true };
}

class Program
{
    /// <summary>
    /// ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
    /// </summary>
    static void Main()
    {
        try
        {
            // åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®è¨­å®šã‚’å–å¾—
            Person embeddingConfig = GetEmbeddingResourceData();
            Console.WriteLine();
            // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®è¨­å®šã‚’å–å¾—
            Person? overrideConfig = GetOverrideData();
            Console.WriteLine();
            // æœ€çµ‚çš„ãªè¨­å®šã‚’å–å¾—
            Person finalConfig = overrideConfig ?? embeddingConfig;
            Console.WriteLine("æœ€çµ‚çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹è¨­å®š:");
            Console.WriteLine(finalConfig);
        }
        catch(JsonException ex)
        {
            Console.WriteLine($"JSONãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚¨ãƒ©ãƒ¼: {ex}");
        }
        catch(Exception ex)
        {
            Console.WriteLine($"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {ex}");
        }
    }


    /// <summary>
    /// åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å–å¾—ã™ã‚‹
    /// </summary>
    private static Person GetEmbeddingResourceData()
    {
        String[] embeddingResourceNames = Assembly.GetExecutingAssembly().GetManifestResourceNames();
        Console.WriteLine($"åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹åä¸€è¦§: {String.Join(Environment.NewLine, embeddingResourceNames)}");

        String envResourceName = "EnvConfigTest.env.json";
        Stream resourceStream = Assembly.GetExecutingAssembly().GetManifestResourceStream(envResourceName)
            ?? throw new InvalidOperationException($"åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹ {envResourceName} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");

        using(resourceStream)
        {
            Person defaultConfig = JsonSerializer.Deserialize<Person>(resourceStream, JsonOptionsProvider.Options)
                ?? throw new InvalidOperationException("åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã«å¤±æ•—ã—ã¾ã—ãŸ");

            Console.WriteLine("åŸ‹ã‚è¾¼ã¿ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:");
            Console.WriteLine(defaultConfig);
            return defaultConfig;
        }
    }


    /// <summary>
    /// å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¨­å®šã‚’å–å¾—ã™ã‚‹
    /// </summary>
    private static Person? GetOverrideData()
    {
        String exeFolderPath = AppDomain.CurrentDomain.BaseDirectory;
        Console.WriteLine($"exeãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹: {exeFolderPath}");

        String envPath = Path.Combine(exeFolderPath, "env.json");
        Console.WriteLine($"env.jsonã®ãƒ‘ã‚¹: {envPath}");

        if(File.Exists(envPath))
        {
            Stream overrideStream = File.OpenRead(envPath);
            using(overrideStream)
            {
                Person overrideConfig = JsonSerializer.Deserialize<Person>(overrideStream, JsonOptionsProvider.Options)
                    ?? throw new InvalidOperationException("å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã«å¤±æ•—ã—ã¾ã—ãŸ");

                Console.WriteLine("å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:");
                Console.WriteLine(overrideConfig);
                return overrideConfig;
            }
        }
        else
        {
            Console.WriteLine($"å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ« {envPath} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
            return null;
        }
    }
}


class Person
{
    public String Name { get; set; } = String.Empty;
    public Int32 Age { get; set; } = -1;
    public String Email { get; set; } = String.Empty;

    public override String ToString() => JsonSerializer.Serialize(this, JsonOptionsProvider.Options);
}
```

## ãŠã‚ã‚Šã«

é‹ç”¨ãƒãƒ¼ãƒ ã®ã“ã¨ã‚’è€ƒãˆãŸã‚Šã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã§ããªã„ç’°å¢ƒã§ã®é–‹ç™ºãªã©ã€å®Ÿå‹™ã§ã—ã‹çµŒé¨“ã—ãªã„ã‚ˆã†ãªã“ã¨ã«å­¦ã³ãŒå¤šã„ã§ã™ã­ï¼